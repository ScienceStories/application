<a id="homeButton" href="/">
  <!-- Science Stories -->
  <img src="/static/images/branding/logo_white.png" alt="Science Stories Logo">
</a>
<button id="arrow">
  <span>↓</span>
</button>
<button id="upArrow">
  <span>↑</span>
</button>
{{#ifUserType user.type 'user'}}
<button id="favoriteBtn" class="{{#if_equal storyActivity.favorite 1}} favorited{{else}}{{/if_equal}}" onclick="toggleFavorite({{row.id}})">
  <span><i class="fas fa-heart"></i></span>
  <span id="favoriteLoader" style="display:hide"><i class="fas fa-spinner fa-spin"></i></span>

</button>
{{/ifUserType}}
<!-- slide types:

  * 1. Intro (background pic + name and 1-line description)
  ! 2. Universal viewer (pdf, video) [Can't do until Mirador updates OpenSeaDragon]
  # 3. Mirador
  # 4. youtube
    5. Side-By-Side
  * 6. Timeline
  * 7. Wikipedia
  * 8. Wikidata
    9. Conclusion (Wikidata, all other resources)
 -->
<script type="text/javascript">
  var wikititle = '{{wikipedia}}'.replace(" ", "_")
</script>
<div id="pagepiling">
  {{#each data}}
    {{loadMoment this.type this}}
  {{/each}}
  {{> wikidata }}
  {{> wikipedia }}
  {{> index }}
</div>
<script>
  data = {{{json data}}};
  lastSlide = data.length;
  tooltips = [];
  colors = [];
  for (x=0; x < lastSlide; x++){
    tooltips.push(data[x].tooltip);
    colors.push(data[x].color);
  }
  lastSlide += 3;
  tooltips = tooltips.concat(['Wikidata Statements', 'Wikipedia Article', 'Learn More About {{name}}']);
  colors = colors.concat([ '#EC008C', '#1dc7ce', 'rgb(255, 185, 125)']);
  $('#pagepiling').pagepiling({
    setMouseWheelScrolling: false,
    verticalCentered: false,
    css3: false,
    sectionsColor: colors,
    navigation: {
      'textColor': '#000',
      'bulletsColor': '#000',
      'position': 'right',
      'tooltips': tooltips
    },
    onLeave: function (index, nextIndex, direction) {
      //fading out the txt of the leaving section
      $('.section').eq(index - 1).find('h1, p').fadeOut(700, 'easeInQuart');
      //fading in the text of the destination (in case it was fadedOut)
      $('.section').eq(nextIndex - 1).find('h1, p').fadeIn(700, 'easeInQuart');
      //reaching our last section? The one with our normal site?
      if (nextIndex == lastSlide) {
        $('#arrow').hide();
        //fading out navigation bullets
        // $('#pp-nav').fadeOut();
        $('#section'+lastSlide)
          .find('.content')
          .animate({top: '0%'}, 700, 'easeInQuart');
      }
      //leaving our last section? The one with our normal site?
      if (index == lastSlide) {
        $('#arrow').show();
        //fadding in navigation bullets
        $('#pp-nav').fadeIn();
        $('#section'+lastSlide+' .content')
          .animate({top: '100%'}, 700, 'easeInQuart');
      }
    },
  });
  $.fn.pagepiling.setAllowScrolling(false);
  $('#arrow').click(function () {
     $.fn.pagepiling.moveSectionDown();
  });
  $('#upArrow').click(function () {
     $.fn.pagepiling.moveSectionUp();
  });
  $('#upArrow').css('z-index', $('.section').length)
$('#favoriteLoader').fadeOut('slow');
  function toggleFavorite(storyId){
    $('#favoriteLoader').fadeIn('slow');
    $.post('/api/member/toggleFavorite', {storyId:storyId})
      .done(function(data){
        $('#favoriteLoader').fadeOut('slow');
        if (data.favorite) $('#favoriteBtn').addClass('favorited')
        else $('#favoriteBtn').removeClass('favorited')
      })
  }
</script>
