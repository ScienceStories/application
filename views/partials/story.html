<a id="homeButton" href="/home">
  <!-- Science Stories -->
  <img src="/static/images/branding/logo_white.png" alt="Science Stories Logo">
</a>
<button id="arrow">
  <span>↓</span>
</button>
<button id="upArrow">
  <span>↑</span>
</button>
<button id="menuBtn" class="" onclick="$('body').toggleClass('sidebar-closed')"  title="Open/Close Menu">
  <span><i class="fas fa-bars"></i></span>
</button>
{{#ifUserType user.type 'user'}}
<button id="favoriteBtn" class="{{#if_equal storyActivity.favorite 1}} favorited{{else}}{{/if_equal}}" onclick="toggleFavorite({{row.id}})"  title="Add/Remove Favorite">
  <span><i class="fas fa-heart"></i></span>
  <span id="favoriteLoader" style="display:hide"><i class="fas fa-spinner fa-spin"></i></span>
</button>
{{/ifUserType}}
{{#ifUserType user.type 'author'}}
<script>var isAuthor = true</script>
<a href="/build?qid={{row.qid}}" title="Edit Story">
<button id="buildBtn" class="" >
  <span><i class="far fa-edit"></i></span>
</button></a>
{{else}}
<script>var isAuthor = false</script>
{{/ifUserType}}
<!-- slide types:

  * 1. Intro (background pic + name and 1-line description)
  ! 2. Universal viewer (pdf, video) [Can't do until Mirador updates OpenSeaDragon]
  # 3. Mirador
  # 4. youtube
    5. Side-By-Side
  * 6. Timeline
  * 7. Wikipedia
  * 8. Wikidata
    9. Conclusion (Wikidata, all other resources)
    10. Map
    11. Library
    12. award
 -->
<script type="text/javascript">
  var wikititle = '{{wikipedia}}'.replace(" ", "_")
  var addthis_share = {
   url: "http://www.sciencestories.io/{{row.qid}}",
   title: "{{title}}",
   description: "{{meta.description}}",
   media: "{{image}}"
}
</script>
<div class="story-sidebar">
  <div class="sidebar-list">
  {{#each data}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)">
      {{#if_equal this.type 'intro'}}
        <i class="far fa-bookmark"></i>
      {{else if_equal this.type 'mirador'}}
        {{#if_equal this.config.data.0.viewType "BookView"}}
          <i class="fas fa-book-open"></i>
        {{else }}
          <i class="far fa-image"></i>
        {{/if_equal}}

      {{else if_equal this.type 'youtube'}}
        <i class="fab fa-youtube"></i>
      {{else}}
        <i class="fas fa-info-circle"></i>
      {{/if_equal}}

      {{#if this.tooltip}}
        {{this.tooltip}}
      {{else if this.title}}
        {{this.title}}
      {{else}}
        {{this.description}}
      {{/if}}
    </div>
  {{/each}}
  {{#if timeline}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><i class="far fa-calendar-alt"></i> Timeline of {{name}}</div>
  {{/if}}
  {{#if map}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><i class="fas fa-map-marked-alt"></i> Map of {{name}}</div>
  {{/if}}
  {{#if library}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><i class="fas fa-archive"></i> Library of {{name}}</div>
  {{/if}}
  {{#if award}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><i class="fas fa-medal"></i> Award Room of {{name}}</div>
  {{/if}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><img src="https://upload.wikimedia.org/wikipedia/commons/6/66/Wikidata-logo-en.svg" alt="Wikidata Logo"> Wikidata Statements</div>
  {{#if wikipedia}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"><img src="https://upload.wikimedia.org/wikipedia/commons/b/b3/Wikipedia-logo-v2-en.svg" alt="Wikidata Logo"> Wikipedia Article</div>
  {{/if}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)"> <i class="far fa-comments"></i> Learn More</div>
</div></div>
<div id="pagepiling">

  {{#each data}}
    {{loadMoment this.type this}}
  {{/each}}
  {{#if timeline}} {{> timeline }} {{/if}}
  {{#if map}} {{> map }} {{/if}}
  {{#if library}} {{> library }} {{/if}}
  {{#if award}} {{> award }} {{/if}}
  {{> wikidata }}
  {{#if wikipedia}} {{> wikipedia }} {{/if}}
  {{> index }}

</div>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b8713ab5154d5c9"></script>
<script>
  data = {{{json data}}};
  lastSlide = data.length;
  tooltips = [];
  colors = [];
  anchors = [];
  for (x=0; x < lastSlide; x++){
    tooltips.push((data[x].tooltip) ? data[x].tooltip : (data[x].title) ? data[x].title : data[x].description);
    colors.push(data[x].color);
  }
  tooltips = tooltips.concat([{{#if timeline}}'Timeline',{{/if}} {{#if map}}'Map',{{/if}} {{#if library}}'Library',{{/if}} {{#if award}}'Awards',{{/if}} 'Wikidata Statements', {{#if wikipedia}}'Wikipedia Article',{{/if}} 'Learn More About {{name}}']);
  colors = colors.concat([{{#if timeline}}'#1dc7ce',{{/if}} {{#if map}}'rgb(29, 206, 173)',{{/if}} {{#if library}}'rgb(220, 132, 83)',{{/if}}  {{#if award}}'rgb(76, 76, 76)',{{/if}}  'rgb(255, 131, 148)', {{#if wikipedia}} 'rgb(129, 130, 160)',{{/if}} 'rgb(255, 185, 125)']);
  lastSlide = tooltips.length;
  for (x=1; x <= lastSlide; x++){
    anchors.push(x)
  }
  $('#pagepiling').pagepiling({
    setMouseWheelScrolling: false,
    verticalCentered: false,
    css3: false,
    sectionsColor: colors,
    navigation: {
      'textColor': '#000',
      'bulletsColor': '#000',
      'position': 'right',
      'tooltips': tooltips
    },
    anchors:anchors,
    onLeave: function (index, nextIndex, direction) {
      $('.sidebar-tooltip').removeClass('active')

      // indx = $(elm).getIndex()+1;

  $('.sidebar-tooltip:nth-child('+nextIndex+')').addClass('active')
      //fading out the txt of the leaving section
      $('.section').eq(index - 1).find('h1, p').fadeOut(700, 'easeInQuart');
      //fading in the text of the destination (in case it was fadedOut)
      $('.section').eq(nextIndex - 1).find('h1, p').fadeIn(700, 'easeInQuart');
      //reaching our last section? The one with our normal site?
      if (nextIndex == lastSlide) {
        $('#arrow').hide();
        //fading out navigation bullets
        // $('#pp-nav').fadeOut();
        $('#section'+lastSlide)
          .find('.content')
          .animate({top: '0%'}, 700, 'easeInQuart');
      }
      //leaving our last section? The one with our normal site?
      if (index == lastSlide) {
        $('#arrow').show();
        //fadding in navigation bullets
        $('#pp-nav').fadeIn();
        $('#section'+lastSlide+' .content')
          .animate({top: '100%'}, 700, 'easeInQuart');
      }
    },
  });
  $.fn.pagepiling.setAllowScrolling(false);
  $('#arrow').click(function () {
     $.fn.pagepiling.moveSectionDown();
  });
  $('#upArrow').click(function () {
     $.fn.pagepiling.moveSectionUp();
  });
  $('#upArrow').css('z-index', $('.section').length)
$('#favoriteLoader').fadeOut('slow');
  function toggleFavorite(storyId){
    $('#favoriteLoader').fadeIn('slow');
    $.post('/api/member/toggleFavorite', {storyId:storyId})
      .done(function(data){
        $('#favoriteLoader').fadeOut('slow');
        if (data.favorite) $('#favoriteBtn').addClass('favorited')
        else $('#favoriteBtn').removeClass('favorited')
      })
  }

  $.fn.getIndex = function(){
	  var $p=$(this).parent().children();
    return $p.index(this);
}
if($(window).width() <= 768) {
  $('body').addClass('sidebar-closed');
}
  function sidebarNavigate(elm){
    var thisindx= $(elm).getIndex() + 1
    $('#pp-nav li:nth-child('+thisindx+') a').click()
    if($(window).width() <= 768) {
      return $('body').addClass('sidebar-closed');
    }

  }
  $(document).ready(function(){
    indx= $('.section.pp-section.active').getIndex() + 1
    $('.sidebar-tooltip:nth-child('+indx+')').addClass('active')
  })
</script>
