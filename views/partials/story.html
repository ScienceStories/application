<a id="homeButton" href="/home">
  <!-- Science Stories -->
  <img src="/static/images/branding/logo_white.png" alt="Science Stories Logo">
</a>
<button id="arrow">
  <span>↓</span>
</button>
<button id="upArrow">
  <span>↑</span>
</button>
{{#ifUserType user.type 'user'}}
<button id="favoriteBtn" class="{{#if_equal storyActivity.favorite 1}} favorited{{else}}{{/if_equal}}" onclick="toggleFavorite({{row.id}})"  title="Add/Remove Favorite">
  <span><i class="fas fa-heart"></i></span>
  <span id="favoriteLoader" style="display:hide"><i class="fas fa-spinner fa-spin"></i></span>
</button>
{{/ifUserType}}
{{#ifUserType user.type 'author'}}
<a href="/build?qid={{row.qid}}" title="Edit Story">
<button id="buildBtn" class="" >
  <span><i class="far fa-edit"></i></span>
</button></a>
{{/ifUserType}}
<!-- slide types:

  * 1. Intro (background pic + name and 1-line description)
  ! 2. Universal viewer (pdf, video) [Can't do until Mirador updates OpenSeaDragon]
  # 3. Mirador
  # 4. youtube
    5. Side-By-Side
  * 6. Timeline
  * 7. Wikipedia
  * 8. Wikidata
    9. Conclusion (Wikidata, all other resources)
 -->
<script type="text/javascript">
  var wikititle = '{{wikipedia}}'.replace(" ", "_")
</script>
<div class="story-sidebar">
  {{#each data}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)">{{this.tooltip}}</div>
  {{/each}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)">Wikidata Statements</div>
  {{#if wikipedia}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)">Wikipedia Article</div>
  {{/if}}
    <div class="sidebar-tooltip" onclick="sidebarNavigate(this)">Learn More</div>
</div>
<div id="pagepiling">
  {{#each data}}
    {{loadMoment this.type this}}
  {{/each}}
  {{> wikidata }}
  {{#if wikipedia}}
    {{> wikipedia }}
  {{/if}}
  {{> index }}
</div>
<script>
  data = {{{json data}}};
  lastSlide = data.length;
  tooltips = [];
  colors = [];
  anchors = [];
  for (x=0; x < lastSlide; x++){
    tooltips.push(data[x].tooltip);
    colors.push(data[x].color);
    anchors.push(x)
  }
  lastSlide += 3;
  tooltips = tooltips.concat(['Wikidata Statements', {{#if wikipedia}}'Wikipedia Article',{{/if}} 'Learn More About {{name}}']);
  colors = colors.concat([ '#EC008C', {{#if wikipedia}}'#1dc7ce',{{/if}} 'rgb(255, 185, 125)']);
  anchors = anchors.concat([lastSlide, lastSlide+1,{{#if wikipedia}}lastSlide+2{{/if}}])

  $('#pagepiling').pagepiling({
    setMouseWheelScrolling: false,
    verticalCentered: false,
    css3: false,
    sectionsColor: colors,
    navigation: {
      'textColor': '#000',
      'bulletsColor': '#000',
      'position': 'right',
      'tooltips': tooltips
    },
    anchors:[1, 2,3,4,5,6,7,8,9,10],
    onLeave: function (index, nextIndex, direction) {
      $('.sidebar-tooltip').removeClass('active')

      // indx = $(elm).getIndex()+1;

  $('.sidebar-tooltip:nth-child('+nextIndex+')').addClass('active')
      //fading out the txt of the leaving section
      $('.section').eq(index - 1).find('h1, p').fadeOut(700, 'easeInQuart');
      //fading in the text of the destination (in case it was fadedOut)
      $('.section').eq(nextIndex - 1).find('h1, p').fadeIn(700, 'easeInQuart');
      //reaching our last section? The one with our normal site?
      if (nextIndex == lastSlide) {
        $('#arrow').hide();
        //fading out navigation bullets
        // $('#pp-nav').fadeOut();
        $('#section'+lastSlide)
          .find('.content')
          .animate({top: '0%'}, 700, 'easeInQuart');
      }
      //leaving our last section? The one with our normal site?
      if (index == lastSlide) {
        $('#arrow').show();
        //fadding in navigation bullets
        $('#pp-nav').fadeIn();
        $('#section'+lastSlide+' .content')
          .animate({top: '100%'}, 700, 'easeInQuart');
      }
    },
  });
  $.fn.pagepiling.setAllowScrolling(false);
  $('#arrow').click(function () {
     $.fn.pagepiling.moveSectionDown();
  });
  $('#upArrow').click(function () {
     $.fn.pagepiling.moveSectionUp();
  });
  $('#upArrow').css('z-index', $('.section').length)
$('#favoriteLoader').fadeOut('slow');
  function toggleFavorite(storyId){
    $('#favoriteLoader').fadeIn('slow');
    $.post('/api/member/toggleFavorite', {storyId:storyId})
      .done(function(data){
        $('#favoriteLoader').fadeOut('slow');
        if (data.favorite) $('#favoriteBtn').addClass('favorited')
        else $('#favoriteBtn').removeClass('favorited')
      })
  }

  $.fn.getIndex = function(){
	  var $p=$(this).parent().children();
    return $p.index(this);
}
  function sidebarNavigate(elm){
    var thisindx= $(elm).getIndex() + 1
    $('#pp-nav li:nth-child('+thisindx+') a').click()

  }
  $(document).ready(function(){
    indx= $('.section.pp-section.active').getIndex() + 1
    $('.sidebar-tooltip:nth-child('+indx+')').addClass('active')
  })
</script>
